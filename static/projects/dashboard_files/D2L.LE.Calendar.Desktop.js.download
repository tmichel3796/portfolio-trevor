D2L.LE.Calendar={};D2L.LE.Calendar.CalendarDay={AdjustWrapper:function(wrapper){var rect=D2L.LP.Web.UI.Html.Dom.GetBoundingRect(wrapper);var viewport=D2L.LP.Web.UI.Html.Dom.GetViewportSize(window);wrapper.style.height=viewport.height-rect.top-12+'px';},Init:function(events){for(var i=0;i<events.length;i++){var width=events[i].offsetWidth-2;if(width<=0){width=1;}events[i].d2l_numCollide=width;events[i].d2l_column=D2L.LP.Web.UI.Html.Css.GetStyle(events[i],'left').replace('px','');}},Resize:function(){var node=D2L.LP.Web.UI.Html.Dom.GetElementsByClassName('d2l-le-calendar-day',document);if(node.length!==1){return;}node=node[0];var eventsTable=D2L.LP.Web.UI.Html.Dom.GetElementsByClassName('d2l-le-calendar-day-events',node);var wrapper=D2L.LP.Web.UI.Html.Dom.GetElementsByClassName('d2l-le-calendar-day-wrapper',node);var events=D2L.LP.Web.UI.Html.Dom.GetElementsByClassName('d2l-le-calendar-event',eventsTable[0]);var isRTL=D2L.LP.Globalization.Locale.GetTextFormatDescriptor().TextDirection==D2L.LP.Globalization.Formatting.Text.TextDirection.RightToLeft;for(var i=0;i<events.length;i++){var numCollide=events[i].d2l_numCollide;var column=events[i].d2l_column;if(numCollide===undefined||column===undefined){return;}var percent=1/numCollide;var leftPercent=column*percent;var offset=107;var totalWidth=wrapper[0].offsetWidth-offset-numCollide*3;var width=percent*totalWidth;var timeDisplayWidth=89;var left=timeDisplayWidth+leftPercent*totalWidth+3*column;events[i].style.width=width+'px';if(isRTL){events[i].style.right=left+'px';}else{events[i].style.left=left+'px';}}D2L.LE.Calendar.CalendarDay.AdjustWrapper(wrapper[0]);}};D2L.LP.Web.UI.Events.OnResize.AddListener(D2L.LE.Calendar.CalendarDay.Resize);D2L.LE.Calendar.CalendarMonth={Resize:function(){var table=D2L.LP.Web.UI.Html.Dom.GetElementsByClassName('d2l-le-calendar-month',document);if(table.length!==1){return;}table=table[0];var events=D2L.LP.Web.UI.Html.Dom.GetElementsByClassName('d2l-le-calendar-event',table);for(var i=0;i<events.length;i++){events[i].style.display='none';}D2L.LE.Calendar.CalendarDay.AdjustWrapper(table);for(var i=0;i<events.length;i++){events[i].style.width=events[i].parentNode.offsetWidth-11+'px';events[i].style.display='block';}}};D2L.LP.Web.UI.Events.OnResize.AddListener(D2L.LE.Calendar.CalendarMonth.Resize);D2L.LE.Calendar.CalendarWeek={InitMultiDay:function(events){var rows=[];var AddRow=function(){var row=[];for(var i=0;i<7;i++){row[i]=0;}rows.push(row);};AddRow();var FindSlot=function(startIndex,numDays){var found=true;for(var i=0;i<rows.length;i++){found=true;for(var j=startIndex;j<startIndex+numDays;j++){if(rows[i][j]===1){found=false;break;}}if(found){for(var j=startIndex;j<startIndex+numDays;j++){rows[i][j]=1;}break;}}if(found){return i;}else{AddRow();return FindSlot(startIndex,numDays);}};for(var day=0;day<events.length;day++){for(var i=0;i<events[day].length;i++){var evtNode=events[day][i];var leftOffset=1;var widthOffset=-1;var numDays=evtNode.offsetWidth;if(!D2L.LP.Web.UI.Html.Dom.HasClassName('d2l-le-calendar-event-noround-right',evtNode)){numDays--;widthOffset=widthOffset-2;}if(!D2L.LP.Web.UI.Html.Dom.HasClassName('d2l-le-calendar-event-noround-left',evtNode)){numDays--;widthOffset=widthOffset-2;}else{leftOffset--;widthOffset--;}evtNode.d2l_widthOffset=widthOffset;evtNode.d2l_leftOffset=leftOffset;evtNode.d2l_numDays=numDays;evtNode.d2l_row=FindSlot(day,numDays);}}},Resize:function(){var node=D2L.LP.Web.UI.Html.Dom.GetElementsByClassName('d2l-le-calendar-week',document);if(node.length!==1){return;}node=node[0];var eventsTable=D2L.LP.Web.UI.Html.Dom.GetElementsByClassName('d2l-le-calendar-week-events',node);var wrapper=D2L.LP.Web.UI.Html.Dom.GetElementsByClassName('d2l-le-calendar-week-wrapper',node);D2L.LE.Calendar.CalendarDay.AdjustWrapper(wrapper[0]);var allDayEventsTable=D2L.LP.Web.UI.Html.Dom.GetElementsByClassName('d2l-le-calendar-week-all',node);var allWrapper=D2L.LP.Web.UI.Html.Dom.GetElementsByClassName('d2l-le-calendar-week-all-wrapper',node);var rows=D2L.LP.Web.UI.Html.Dom.GetElementsByClassName('d2l-le-calendar-in',node);var daysC=D2L.LP.Web.UI.Html.Dom.GetElementsByClassName('d2l-le-calendar-week-days',node);var days=D2L.LP.Web.UI.Html.Dom.GetElementsByClassName('d2l-le-calendar-week-header',daysC[0]);var allC=D2L.LP.Web.UI.Html.Dom.GetElementsByClassName('d2l-le-calendar-week-all',node);var all=D2L.LP.Web.UI.Html.Dom.GetElementsByClassName('d2l-le-calendar-week-header',allC[0]);var isRTL=D2L.LP.Globalization.Locale.GetTextFormatDescriptor().TextDirection==D2L.LP.Globalization.Formatting.Text.TextDirection.RightToLeft;var offsets=[];var totalWidth=wrapper[0].offsetWidth-1;for(var i=0;i<rows[0].cells.length;i++){var width=rows[0].cells[i].offsetWidth-1;if(width<0){width=0;}if(window.getComputedStyle!==undefined){width=window.getComputedStyle(rows[0].cells[i],null).width;if(width.substr(width.length-2,2)=='px'){width=width.substr(0,width.length-2);}width=parseFloat(width);}if(i===0){offsets[0]=width+1;}else{offsets[i]=offsets[i-1]+width+1;}days[i].style.width=width+'px';all[i].style.width=width+'px';}var scrollBarWidth=allWrapper[0].offsetWidth-offsets[7]+1;var maxRow=0;var dayEvents=node.d2l_dayEvents;var multiDayEvents=node.d2l_multiDayEvents;if(dayEvents===undefined){return;}for(var day=0;day<7;day++){for(var i=0;i<dayEvents[day].length;i++){var numCollide=dayEvents[day][i].d2l_numCollide;var column=dayEvents[day][i].d2l_column;var percent=1/numCollide;var leftPercent=column*percent;var dayWidth=offsets[day+1]-offsets[day]-numCollide*2-10;var width=percent*dayWidth;var left=offsets[day]+1+leftPercent*dayWidth+3*column;dayEvents[day][i].style.width=width+'px';if(isRTL){dayEvents[day][i].style.right=left+'px';}else{dayEvents[day][i].style.left=left+'px';}}for(var i=0;i<multiDayEvents[day].length;i++){var numDays=multiDayEvents[day][i].d2l_numDays;var leftOffset=multiDayEvents[day][i].d2l_leftOffset;var widthOffset=multiDayEvents[day][i].d2l_widthOffset;var row=multiDayEvents[day][i].d2l_row;if(row>maxRow){maxRow=row;}var left=offsets[day]+leftOffset;var width=offsets[day+numDays]-offsets[day]+(1-leftOffset)+widthOffset;if(day+numDays>6){width+=scrollBarWidth;}if(width<0){width=0;}var top=row*31+1;multiDayEvents[day][i].style.top=top+'px';if(isRTL){multiDayEvents[day][i].style.right=left+'px';}else{multiDayEvents[day][i].style.left=left+'px';}multiDayEvents[day][i].style.width=width+'px';}}var index=1;if(allDayEventsTable[0].rows.length<=1){index=0;}allDayEventsTable[0].rows[index].style.height=(maxRow+1)*31+1+'px';}};D2L.LP.Web.UI.Events.OnResize.AddListener(D2L.LE.Calendar.CalendarWeek.Resize);D2L.LE.Calendar.When={GetHiddenInput:function(baseId,containerId){var id=D2L.LE.Calendar.When.GetHiddenInputId(baseId,containerId);return D2L.LP.Web.UI.Desktop.Controls.DateTimeSelector.GetSelectedDateTime(id);},GetHiddenInputId:function(baseId,containerId){var containerIdString=containerId.GetValue();var container=document.querySelector('#'+containerIdString);var elem=container.querySelector('[id*="'+baseId+'"][class*="d2l-datetime-selector-date-input"]');return new D2L.LP.Web.UI.Html.AbsoluteHtmlId(elem.id);},SetDateTime:function(id,value){D2L.LP.Web.UI.Desktop.Controls.DateTimeSelector.SetSelectedDateTime(id,value);},SetDateTimeRange:function(id,startValue,endValue){D2L.LP.Web.UI.Desktop.Controls.DateTimeRange.SetSelectedStartDateTime(id,startValue);setTimeout(function(){D2L.LP.Web.UI.Desktop.Controls.DateTimeRange.SetSelectedEndDateTime(id,endValue);},0);},SetHiddenInput:function(baseId,value,containerId){var id=D2L.LE.Calendar.When.GetHiddenInputId(baseId,containerId);D2L.LP.Web.UI.Desktop.Controls.DateTimeSelector.SetSelectedDateTime(id,value);},SetHiddenInputDateOnly:function(baseId,value,containerId){var id=D2L.LE.Calendar.When.GetHiddenInputId(baseId,containerId);var prevDateTime=D2L.LP.Web.UI.Desktop.Controls.DateTimeSelector.GetSelectedDateTime(id);var newValue=new D2L.LocalDateTime(value.GetYear(),value.GetMonth(),value.GetDay(),prevDateTime.GetHour(),prevDateTime.GetMinute(),0);D2L.LP.Web.UI.Desktop.Controls.DateTimeSelector.SetSelectedDateTime(id,newValue);}};D2L.LE.Calendar.Home={m_selectedYear:0,m_selectedMonth:0,m_selectedDay:0,SetSelectedDate:function(year,month,day){D2L.LE.Calendar.Home.m_selectedYear=year;D2L.LE.Calendar.Home.m_selectedMonth=month;D2L.LE.Calendar.Home.m_selectedDay=day;},SetSelectedLocalDateTime:function(date){D2L.LE.Calendar.Home.m_selectedYear=date.GetYear();D2L.LE.Calendar.Home.m_selectedMonth=date.GetMonth();D2L.LE.Calendar.Home.m_selectedDay=date.GetDay();},GetSelectedDay:function(){return D2L.LE.Calendar.Home.m_selectedDay;},GetSelectedMonth:function(){return D2L.LE.Calendar.Home.m_selectedMonth;},GetSelectedYear:function(){return D2L.LE.Calendar.Home.m_selectedYear;}};D2L.LP.Web.UI.Html.Dom.AddClassInitializer('d2l-le-calendar-day',function(node){var rows=D2L.LP.Web.UI.Html.Dom.GetElementsByClassName('d2l-le-calendar-in',node);var wrapper=D2L.LP.Web.UI.Html.Dom.GetElementsByClassName('d2l-le-calendar-day-wrapper',node);var eventsTable=D2L.LP.Web.UI.Html.Dom.GetElementsByClassName('d2l-le-calendar-day-events',node);if(wrapper.length!==1||rows.length===0||eventsTable.length!==1){return;}var events=D2L.LP.Web.UI.Html.Dom.GetElementsByClassName('d2l-le-calendar-event',eventsTable[0]);D2L.LE.Calendar.CalendarDay.Init(events);D2L.LE.Calendar.CalendarDay.Resize();wrapper[0].scrollTop=rows[0].offsetTop;});D2L.LP.Web.UI.Html.Dom.AddClassInitializer('d2l-le-calendar-event',function(node){D2L.LP.Web.UI.Html.Dom.SetAttribute(node,'href','javascript:void(0);');});D2L.LP.Web.UI.Html.Dom.AddClassInitializer('d2l-le-calendar-month',function(node){D2L.LE.Calendar.CalendarMonth.Resize();});D2L.LP.Web.UI.Html.Dom.AddClassInitializer('d2l-le-calendar-week',function(node){var rows=D2L.LP.Web.UI.Html.Dom.GetElementsByClassName('d2l-le-calendar-in',node);var wrapper=D2L.LP.Web.UI.Html.Dom.GetElementsByClassName('d2l-le-calendar-week-wrapper',node);var eventsTable=D2L.LP.Web.UI.Html.Dom.GetElementsByClassName('d2l-le-calendar-week-events',node);var allDayEventsTable=D2L.LP.Web.UI.Html.Dom.GetElementsByClassName('d2l-le-calendar-week-all',node);if(wrapper.length!==1||eventsTable.length!==1||allDayEventsTable.length!==1||rows.length===0){return;}var events=D2L.LP.Web.UI.Html.Dom.GetElementsByClassName('d2l-le-calendar-event',eventsTable[0]);var dayEvents=[];var multiDayEvents=[];for(var i=0;i<7;i++){dayEvents[i]=[];multiDayEvents[i]=[];}for(var i=1;i<eventsTable[0].rows.length;i++){var start=i%2==0?0:1;for(var j=start;j<eventsTable[0].rows[i].cells.length;j++){var day=j-1;if(i%2==0){day++;}var hourEvents=D2L.LP.Web.UI.Html.Dom.GetElementsByClassName('d2l-le-calendar-event',eventsTable[0].rows[i].cells[j]);for(var k=0;k<hourEvents.length;k++){dayEvents[day].push(hourEvents[k]);}}}var index=1;if(allDayEventsTable[0].rows.length<=1){index=0;}for(var i=1;i<allDayEventsTable[0].rows[index].cells.length;i++){var hourEvents=D2L.LP.Web.UI.Html.Dom.GetElementsByClassName('d2l-le-calendar-event',allDayEventsTable[0].rows[index].cells[i]);for(var j=0;j<hourEvents.length;j++){multiDayEvents[i-1].push(hourEvents[j]);}}for(var i=0;i<7;i++){D2L.LE.Calendar.CalendarDay.Init(dayEvents[i]);}D2L.LE.Calendar.CalendarWeek.InitMultiDay(multiDayEvents);node.d2l_dayEvents=dayEvents;node.d2l_multiDayEvents=multiDayEvents;D2L.LE.Calendar.CalendarWeek.Resize();wrapper[0].scrollTop=rows[0].offsetTop;setTimeout(function(){D2L.LE.Calendar.CalendarWeek.Resize();setTimeout(function(){D2L.LE.Calendar.CalendarWeek.Resize();},0);},0);});